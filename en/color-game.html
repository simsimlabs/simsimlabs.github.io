<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Sense Test | Boredom Lab</title>
    <link rel="stylesheet" href="../style.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2261846676525942"
     crossorigin="anonymous"></script>
    <style>
        #game-board { display: grid; gap: 5px; width: 300px; height: 300px; margin: 0 auto; background: #eee; padding: 5px; border-radius: 10px; }
        .color-box { border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <header><a href="index.html" class="logo">üß™ Boredom Lab</a></header>
    <div class="container">
        <div class="ad-placeholder">(Ads)</div>
        <div id="start-screen" class="content-box">
            <div style="font-size:3rem;">üé®</div>
            <h1>Color Sense Test</h1>
            <p>One square has a <strong>different color</strong>.<br>Find it before time runs out!</p>
            <button class="btn" onclick="startGame()">Start Game</button>
        </div>
        <div id="game-screen" class="content-box hidden">
            <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:10px;">
                <span id="score-display">Lv. 1</span>
                <span id="time-display" style="color:red;">15.0s</span>
            </div>
            <div id="game-board"></div>
        </div>
        <div id="result-screen" class="content-box hidden">
            <h1>‚è≥ Time's Up!</h1>
            <h2>Level: <span id="final-score" style="color:var(--primary);">0</span></h2>
            <div id="rank-text" style="margin:20px 0; font-weight:bold;"></div>
            <button class="btn" onclick="location.reload()">Try Again</button>
        </div>
        <footer>
            <p>¬© 2024 Boredom Lab</p>
            <p><a href="../privacy.html">Privacy</a></p>
        </footer>
    </div>
    <script>
        let level = 1, timeLeft = 15.0, timer;
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            nextLevel();
            timer = setInterval(() => {
                timeLeft -= 0.1;
                document.getElementById('time-display').innerText = timeLeft.toFixed(1) + "s";
                if(timeLeft <= 0) gameOver();
            }, 100);
        }
        function nextLevel() {
            document.getElementById('score-display').innerText = `Lv. ${level}`;
            const board = document.getElementById('game-board'); board.innerHTML = '';
            let size = Math.min(Math.ceil((level + 1) / 2) + 1, 8);
            board.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            let r=Math.floor(Math.random()*200)+20, g=Math.floor(Math.random()*200)+20, b=Math.floor(Math.random()*200)+20;
            let diff=Math.max(30-level*1.5, 5);
            let correctIndex=Math.floor(Math.random()*(size*size));
            for(let i=0; i<size*size; i++) {
                let box=document.createElement('div'); box.className='color-box';
                if(i===correctIndex) { box.style.backgroundColor=`rgb(${r+diff},${g+diff},${b+diff})`; box.onclick=()=>{ level++; timeLeft+=1.0; nextLevel(); }; }
                else { box.style.backgroundColor=`rgb(${r},${g},${b})`; box.onclick=()=>{ timeLeft-=2.0; board.style.animation="shake 0.3s"; }; }
                board.appendChild(box);
            }
        }
        function gameOver() {
            clearInterval(timer);
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = level;
            let msg = level < 15 ? "You need better eyes!" : "Amazing vision!";
            document.getElementById('rank-text').innerText = msg;
        }

/* === Smart Share Function (Replace the old one) === */
function shareTwitter() {
    var sendText = document.title;
    var sendUrl = window.location.href;

    var resultScreen = document.getElementById('result-screen');
    if (resultScreen && !resultScreen.classList.contains('hidden')) {
        var resultTitle = document.getElementById('result-title').innerText;
        // Text format: [My Result] Title
        sendText = "[My Result] " + resultTitle + " | " + document.title;
    }

    window.open("https://twitter.com/intent/tweet?text=" + encodeURIComponent(sendText) + "&url=" + encodeURIComponent(sendUrl));
}

function shareFacebook() {
    var sendUrl = window.location.href;
    window.open("http://www.facebook.com/sharer/sharer.php?u=" + sendUrl);
}

function copyLink() {
    var sendUrl = window.location.href;
    var textToCopy = sendUrl;

    var resultScreen = document.getElementById('result-screen');
    if (resultScreen && !resultScreen.classList.contains('hidden')) {
        var resultTitle = document.getElementById('result-title').innerText;
        var resultDesc = document.getElementById('result-desc').innerText;
        
        textToCopy = "üì¢ My Result: " + resultTitle + "\n" + resultDesc + "\n\nTry it here üëâ " + sendUrl;
    }

    navigator.clipboard.writeText(textToCopy).then(function() {
        alert("Result & Link Copied! \nPaste it to your friends.");
    });
}
        
    </script>
</body>
</html>
